â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    LEGEND AI - SYSTEM ARCHITECTURE                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ–¥ï¸  FRONTEND LAYER                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  Dashboard UI    â”‚  â”‚  Telegram Bot    â”‚  â”‚  Web Charts      â”‚           â”‚
â”‚  â”‚  (HTML/JS/CSS)   â”‚  â”‚  (Commands)      â”‚  â”‚  (TradingView)   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼ HTTP/Webhook
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸš€ API GATEWAY (FastAPI)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Middleware Stack:                                                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ Metrics (Prometheus)                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ Structured Logging & Telemetry                                â”‚   â”‚
â”‚  â”‚  â”œâ”€ Rate Limiting (60 req/min per IP)                             â”‚   â”‚
â”‚  â”‚  â””â”€ CORS (Environment-aware)                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€ Router 1 â”€â”€â”  â”Œâ”€ Router 2 â”€â”€â”  â”Œâ”€ Router 3 â”€â”€â”      â”Œâ”€ Router N â”€â”€â”  â”‚
â”‚  â”‚  /analyze   â”‚  â”‚  /patterns  â”‚  â”‚  /watchlist â”‚ ... â”‚  /telegram  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  15 API Routers | 60+ Endpoints | Full OpenAPI Documentation              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚         â”‚              â”‚
    â–¼         â–¼         â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVICES â”‚ â”‚ CORE LOGIC     â”‚ â”‚ CACHE LAYER  â”‚ â”‚ DATA ACCESS      â”‚
â”‚          â”‚ â”‚                â”‚ â”‚              â”‚ â”‚                  â”‚
â”‚ â”œâ”€ Marketâ”‚ â”‚ â”œâ”€ Detectors:  â”‚ â”‚ Redis (Async)â”‚ â”‚ PostgreSQL ORM   â”‚
â”‚ â”‚ Data   â”‚ â”‚ â”‚  VCP         â”‚ â”‚              â”‚ â”‚ (Connection Pool)â”‚
â”‚ â”‚        â”‚ â”‚ â”‚  Cup & Handleâ”‚ â”‚ Key Types:   â”‚ â”‚                  â”‚
â”‚ â”œâ”€ Scannerâ”‚ â”‚ â”‚  Triangles  â”‚ â”‚ â”œâ”€ pattern  â”‚ â”‚ SQLAlchemy 2.0   â”‚
â”‚ â”‚ Service â”‚ â”‚ â”‚  H&S        â”‚ â”‚ â”œâ”€ ohlcv    â”‚ â”‚                  â”‚
â”‚ â”‚        â”‚ â”‚ â”‚  Channels   â”‚ â”‚ â”œâ”€ watchlistâ”‚ â”‚ Models:          â”‚
â”‚ â”œâ”€ Alerts  â”‚ â”‚ â”‚  Wedges    â”‚ â”‚ â”œâ”€ chart    â”‚ â”‚ â”œâ”€ Ticker        â”‚
â”‚ â”‚ Service  â”‚ â”‚ â”‚  Double Topâ”‚ â”‚ â””â”€ api_usageâ”‚ â”‚ â”œâ”€ Watchlist     â”‚
â”‚ â”‚        â”‚ â”‚ â”‚  SMA50      â”‚ â”‚              â”‚ â”‚ â”œâ”€ PatternScan   â”‚
â”‚ â”œâ”€ Chartingâ”‚ â”‚ â”‚            â”‚ â”‚ TTL: 15min- â”‚ â”‚ â”œâ”€ ScanLog       â”‚
â”‚ â”‚ Service  â”‚ â”‚ â”‚ â”œâ”€ Scoring â”‚ â”‚ 24hrs       â”‚ â”‚ â”œâ”€ AlertLog      â”‚
â”‚ â”‚        â”‚ â”‚ â”‚ â”œâ”€ Indicatorsâ”‚ â”‚              â”‚ â”‚ â””â”€ UniverseScan  â”‚
â”‚ â”œâ”€ Trades  â”‚ â”‚ â”‚ â”‚ (SMA,EMA, â”‚ â”‚ Hit Rate:   â”‚ â”‚                  â”‚
â”‚ â”‚ Service  â”‚ â”‚ â”‚ â”‚  RSI,ATR) â”‚ â”‚ 60-95%      â”‚ â”‚ Optimizations:   â”‚
â”‚ â”‚        â”‚ â”‚ â”‚ â”œâ”€ Risk Calc â”‚ â”‚              â”‚ â”‚ â”œâ”€ Bulk Inserts  â”‚
â”‚ â”œâ”€ Risk    â”‚ â”‚ â”‚ â””â”€ Minerviniâ”‚ â”‚ Usage       â”‚ â”‚ â”œâ”€ Indexes       â”‚
â”‚ â”‚ Calculatorâ”‚ â”‚ â”‚  Trends    â”‚ â”‚ Tracking    â”‚ â”‚ â”œâ”€ Queries       â”‚
â”‚ â”‚        â”‚ â”‚ â”‚                â”‚ â”‚ (24hr reset)â”‚ â”‚ â””â”€ Pre-fetching  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚ â”‚              â”‚ â”‚                  â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚ â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                    â”‚               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  EXTERNAL INTEGRATIONS (Fallback)      â”‚
        â”‚                                        â”‚
        â”‚  Market Data Priority:                 â”‚
        â”‚  1. Redis Cache (15min) âœ“ Fastest     â”‚
        â”‚  2. TwelveData (800/day)               â”‚
        â”‚  3. Finnhub (60/day)                   â”‚
        â”‚  4. Alpha Vantage (500/day)            â”‚
        â”‚  5. Yahoo Finance (unlimited)          â”‚
        â”‚                                        â”‚
        â”‚  Notifications:                        â”‚
        â”‚  â”œâ”€ Telegram Bot (unlimited)           â”‚
        â”‚  â”œâ”€ Email (SendGrid)                   â”‚
        â”‚  â””â”€ Push Notifications                 â”‚
        â”‚                                        â”‚
        â”‚  Charts:                               â”‚
        â”‚  â””â”€ Chart-IMG (500/day)                â”‚
        â”‚                                        â”‚
        â”‚  AI Analysis:                          â”‚
        â”‚  â””â”€ OpenRouter (Claude, GPT-4)         â”‚
        â”‚                                        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š WATCHLIST FEATURE - COMPONENT INTERACTION

  User Interface        API Endpoint          Service Layer          Database
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Add NVDA to  â”‚      â”‚ POST /watchlistâ”‚    â”‚ DatabaseService  â”‚  â”‚ Watchlist
  â”‚ Watchlist    â”‚â”€â”€â”€â”€â”€>â”‚ /add           â”‚â”€â”€â”€>â”‚ .add_watchlist   â”‚â”€>â”‚ table
  â”‚              â”‚      â”‚                â”‚    â”‚ _symbol()        â”‚  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                      â”‚                       â”‚                  â”‚
       â”‚                      â–¼                       â–¼                  â–¼
       â”‚              Update Cache                 Cache Updated    Data Stored
       â”‚              (watchlist:items)         (3600s TTL)
       â”‚
       â”‚ Background Task Starts
       â”‚
       â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. AlertService.monitor_watchlist() runs periodically        â”‚
  â”‚                                                               â”‚
  â”‚ 2. For each watchlist item:                                  â”‚
  â”‚    â”œâ”€ MarketDataService.get_time_series(NVDA)              â”‚
  â”‚    â”œâ”€ Check Redis Cache (15min TTL)                        â”‚
  â”‚    â””â”€ Fetch from TwelveData â†’ Finnhub â†’ ... (fallback)    â”‚
  â”‚                                                               â”‚
  â”‚ 3. Pattern Detectors run in parallel:                        â”‚
  â”‚    â”œâ”€ VCPDetector.detect()                                  â”‚
  â”‚    â”œâ”€ CupHandleDetector.detect()                            â”‚
  â”‚    â”œâ”€ TriangleDetector.detect()                             â”‚
  â”‚    â””â”€ ... (8 total detectors)                               â”‚
  â”‚                                                               â”‚
  â”‚ 4. If Pattern Found (confidence >= 0.75):                    â”‚
  â”‚    â”œâ”€ Update watchlist status to "Triggered"                â”‚
  â”‚    â”œâ”€ Send Telegram alert with chart                        â”‚
  â”‚    â”œâ”€ Log to AlertLog table                                 â”‚
  â”‚    â”œâ”€ Set 6-hour cooldown (prevent spam)                    â”‚
  â”‚    â””â”€ Generate Chart-IMG preview                            â”‚
  â”‚                                                               â”‚
  â”‚ 5. User sees updated watchlist with status                   â”‚
  â”‚    â”œâ”€ Real-time price                                       â”‚
  â”‚    â”œâ”€ Pattern detected badge                                â”‚
  â”‚    â”œâ”€ Entry/Stop/Target prices                              â”‚
  â”‚    â””â”€ Risk/Reward ratio                                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ KEY PERFORMANCE METRICS

  Pattern Detection:        Market Data Fetch:     Cache Performance:
  â”œâ”€ Cold: 1-3 sec         â”œâ”€ TwelveData: ~500ms  â”œâ”€ Hit Rate: 60-95%
  â”œâ”€ Cached: <100ms        â”œâ”€ Finnhub: ~400ms     â”œâ”€ Pattern: 60-70%
  â”œâ”€ Universe Scan: 30-60s  â”œâ”€ Cache: ~50ms        â”œâ”€ Market Data: 80-85%
  â””â”€ Confidence: 0-10      â””â”€ Fallback: ~1.5s     â””â”€ Universe: ~95%

  Database Performance:      Throughput:           Scalability:
  â”œâ”€ Watchlist ops: <5ms    â”œâ”€ 60 req/min limit    â”œâ”€ Async throughout
  â”œâ”€ Pattern scan: <20ms    â”œâ”€ Rate limited by IP  â”œâ”€ Background tasks
  â”œâ”€ Bulk inserts: 50-100ms â””â”€ Burst handling      â””â”€ Connection pool

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
